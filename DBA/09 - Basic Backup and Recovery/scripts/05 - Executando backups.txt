---------------------------------------------------------------------------------|
| Aula      : Executando backups                                                 |
| MÃ³dulo    : Basic Backup and Recovery                                          |
| Curso     : Oracle Fundamentals                                                |
| Instrutor : Marcio Mandarino                                                   |
| URL       : mrdba.com.br/oracle_fundamentals                                   |
|--------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/backing-up-database.html#GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7
|--------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Aprender a fazer backup do banco em diferentes tipos de cenÃ¡rio

=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ Fazendo um backup full 
ğŸ“ Fazendo um backup apenas dos archives
ğŸ“ Fazendo um backup incremental level 0 
ğŸ“ Fazendo um backup incremental level 1 (diferencial)
ğŸ“ Fazendo um backup incremental level 1 (cumulativo)
ğŸ“ Fazendo fora da Fast Recovery Area
ğŸ“ Backup em ambientes Multitenant
ğŸ“ ConclusÃ£o

=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ Existem vÃ¡rias formas de se fazer backup no banco de dados Oracle
â–¶ï¸ Como vimos em aulas anteriores, temos 3 tipos de backup via RMAN:
  â–«ï¸ Backup Full
  â–«ï¸ Backup Incremental (Diferencial e Cumulativo)
  â–«ï¸ Backup de archives
  â–«ï¸ Backup do SPFILE
  â–«ï¸ Backup do controlfile


=================================================================
== ğŸ¯ Fazendo um backup full 
=================================================================
RMAN> run
{
backup
  as compressed backupset
  skip inaccessible
  tag bkp_full
  database plus archivelog;
delete
	noprompt archivelog all
	backed up 1 times to disk;
backup
  tag bkp_full_ctfile
    (current controlfile);
backup
  tag bkp_full_spfile
   (spfile);
}

â–¶ï¸ Em um Ãºnico comando estÃ£o sendo realizadas 4 operaÃ§Ãµes
â–¶ï¸ OperaÃ§Ã£o 1: Backup Full do banco
	â–«ï¸ Backup Full do banco
	â–«ï¸ "Pula" arquivos inacessÃ­veis (skip inaccessible)
	â–«ï¸ Define uma tag para o backup Full
	â–«ï¸ Faz o backup dos archives logs 
â–¶ï¸ OperaÃ§Ã£o 2: Excluir archives logs
	â–«ï¸ Exclui os archives que tiveram ao menos 1 backup para disco
â–¶ï¸ OperaÃ§Ã£o 3: Backup dos arquivos de controls
	â–«ï¸ Faz o backup dos arquivos de controle 
â–¶ï¸ OperaÃ§Ã£o 4: Faz o backup do spfile
	â–«ï¸ Faz o backup dos arquivos de controle 



=================================================================
== ğŸ¯ Fazendo um backup apenas dos archives
=================================================================
RMAN> run
{
allocate channel ch01 device type disk;
allocate channel ch02 device type disk;
allocate channel ch03 device type disk;
allocate channel ch04 device type disk;
backup
  as compressed backupset
  skip inaccessible
  tag BKP_ARCHS
  (archivelog all);
delete
	noprompt archivelog all
	backed up 1 times to disk;
backup
  tag backup_ctfile
    (current controlfile);
backup
  tag backup_spfile
   (spfile);
release channel ch01;
release channel ch02;
release channel ch03;
release channel ch04;
}


=================================================================
== ğŸ¯ Fazendo um backup incremental level 0 
=================================================================
RMAN> run
{
backup
  as compressed backupset
  incremental level 0
  skip inaccessible
  tag BKP_INCR_N0
  database plus archivelog;
delete
	noprompt archivelog all
	backed up 1 times to disk;
backup
  tag backup_ctfile
    (current controlfile);
backup
  tag backup_spfile
   (spfile);
}


=================================================================
== ğŸ¯ Fazendo um backup incremental level 1 (diferencial)
=================================================================
RMAN> run
{
backup
  as compressed backupset
  incremental level 1 
  skip inaccessible
  tag BKP_INCR_N1
  database plus archivelog;
delete
	noprompt archivelog all
	backed up 1 times to disk;
backup
  tag backup_ctfile
    (current controlfile);
backup
  tag backup_spfile
   (spfile);
}


=================================================================
== ğŸ¯ Fazendo um backup incremental level 1 (cumulativo)
=================================================================
RMAN> run
{
backup
  as compressed backupset
  incremental level 1 cumulative
  skip inaccessible
  tag BKP_INCR_N1_CUM
  database plus archivelog;
delete
	noprompt archivelog all
	backed up 1 times to disk;
backup
  tag backup_ctfile
    (current controlfile);
backup
  tag backup_spfile
   (spfile);
}




=================================================================
== ğŸ¯ Fazendo fora da Fast Recovery Area
=================================================================

$ mkdir /home/oracle/bkp

run
{
backup
  as compressed backupset
  skip inaccessible
  tag BKP_FULL
  database plus archivelog FORMAT '/home/oracle/bkp/backup_%U';
delete
  noprompt archivelog all
  backed up 1 times to disk;
backup
  tag backup_ctfile
    (current controlfile);
backup
  tag backup_spfile
   (spfile);
}

=================================================================
== ğŸ¯ Backup em ambientes Multitenant 
=================================================================
â–¶ï¸ Ã‰ praticamente a mesma coisa que backups em ambientes non-cdb
â–¶ï¸ A Ãºnica diferenÃ§a Ã© que vocÃª pode (Se quiser), realizar operaÃ§Ãµes de backups em pdbs, de forma individual
â–¶ï¸ Quando vocÃª se conecta no container (rman target /), vocÃª faz backup de todos os pdbs

$ . oraenv
ORACLE_SID = [orcl] ? cdb1
$ rman target /
RMAN> exit
$ export ORACLE_PDB_SID=pdb1
$ rman target /
RMAN> BACKUP PLUGGABLE DATABASE pdb1;

ğŸ’¡ VocÃª pode fazer backup de mÃºltiplos PDBs, basta separar por vÃ­rgula.


=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ Pratique a execuÃ§Ã£o dos comandos desta aula
ğŸ’¡ Tente escrever os comandos para fixar, nÃ£o copie e cole
 