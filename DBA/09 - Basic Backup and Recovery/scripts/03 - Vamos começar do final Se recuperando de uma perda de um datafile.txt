|--------------------------------------------------------------------------------|
| Aula      : Vamos comeÃ§ar do final? Se recuperando de uma perda de um datafile!|
| MÃ³dulo    : Basic Backup and Recovery                                          |
| Curso     : Oracle Fundamentals                                                |
| Instrutor : Marcio Mandarino                                                   |
| URL       : mrdba.com.br/oracle_fundamentals                                   |
|--------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/diagnosing-repairing-failures-dra.html
|--------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Mostrar como pode ser simples o processo de recuperaÃ§Ã£o de um desastre
ğŸ’¡ Como se recuperar de uma perda de um arquivo de dados

=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ Executando o client do RMAN
ğŸ“ Executando um backup
ğŸ“ Simulando uma falha (perda de um datafile)
ğŸ“ Restaurando o datafile usando os advisors
ğŸ“ Entendendo os passos da recuperaÃ§Ã£o
ğŸ“ ConclusÃ£o

=================================================================
== ğŸ¯ Conceito geral
=================================================================
ğŸ‰ O processo de recuperaÃ§Ã£o do banco, pode ser simples
ğŸ¤¡ O processo de recuperaÃ§Ã£o do banco, pode ser complexo
â–¶ï¸ Cada caso Ã© um caso
â–¶ï¸ Temos que comeÃ§ar do bÃ¡sico, evoluindo no processo de aprendizado do RMAN
â–¶ï¸ Vamos simular um cenÃ¡rio simples, para mostrar como Ã© fÃ¡cil usar o RMAN


=================================================================
== Executando o client do RMAN
=================================================================
% export ORACLE_SID=orcl
% rman
% rman TARGET sys@orcl NOCATALOG
% rman TARGET /

RMAN> EXIT



=================================================================
== Executando um backup
=================================================================
RMAN> backup database;

ğŸ’¡ Simples nÃ©!?
ğŸ¤¡ Eu brinco que fazer backup todo mundo faz, mas e fazer o restore? 



=================================================================
== Simulando uma falha (perda de um datafile)
=================================================================
-- sessÃ£o 2
$ adrci
adrci> show homes
adrci> set home diag/rdbms/orcl/orcl
adrci> show alert -tail -f

-- sessÃ£o 3
$ rm -rf /u02/oradata/ORCL/datafile/o1_mf_soe_m66rhj41_.dbf
$ . oraenv

$ sqlplus / as sysdba
SQL> select count(1) from SOE.INVENTORIES;

=================================================================
== Restaurando o datafile usando os advisors 
=================================================================
RMAN> list failure;
RMAN> advise failure;
RMAN> repair failure preview;
RMAN> repair failure noprompt;

ğŸ‰ ParabÃ©ns, vocÃª fez seu primeiro recovery!
ğŸ¤¡ Mas nÃ£o sem empolgue, nem sempre na vida real Ã© tÃ£o simples assim!
ğŸ’¡ O que eu queria mostrar, Ã© que nÃ£o Ã© um bicho de 7 cabeÃ§as!

=================================================================
== Entendendo os passos da recuperaÃ§Ã£o 
=================================================================

contents of repair script:
   # restore and recover datafile
   sql 'alter database datafile 5 offline';
   restore ( datafile 5 );
   recover datafile 5;
   sql 'alter database datafile 5 online';

1ï¸âƒ£ Colocou o datafile offline
2ï¸âƒ£ Executou o restore do arquivo de dados (LÃª a peÃ§a de backup)
3ï¸âƒ£ Executou o recover do datafile (Utiliza os archives e a Ã¡rea de redo)
4ï¸âƒ£ Colocou novamente o datafile online
ğŸ’¡ Ã‰ preciso compreender a diferenÃ§a entre restore e recover!


=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ Nem sempre o processo de recuperaÃ§Ã£o Ã© um bicho de 7 cabeÃ§as!
ğŸ’¡ Tente escrever os comandos para fixar, nÃ£o copie e cole

 