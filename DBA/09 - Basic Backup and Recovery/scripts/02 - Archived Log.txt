|-------------------------------------------------------------------------------|
| Aula      : Archived Log                                                      |
| M√≥dulo    : Basic Backup and Recovery                                         |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| Refer√™ncia: https://docs.oracle.com/en/database/oracle/oracle-database/23/admin/managing-archived-redo-log-files.html#GUID-5EE4AC49-E1B2-41A2-BEE7-AA951EAAB2F3
|-------------------------------------------------------------------------------|


=================================================================
== üéØ Objetivos da Aula:
=================================================================
üí° Compreender a import√¢ncia de manter o banco em archivelog mode
üí° Como ativar o archivelog
 

=================================================================
== üéØ Resumo
=================================================================
üìç Introdu√ß√£o
üìç NOARCHIVELOG e ARCHIVELOG
üìç Definindo o destino dos archives
üìç Formatando o nome do arquivo 
üìç Ativando o archivelog
üìç Responsabilidades do DBA
üìç Executando um backup dos archives
üìç Monitorando os archives
üìç Excluindo archives

=================================================================
== üéØ Conceito geral
=================================================================
‚ñ∂Ô∏è  O Oracle permite que voc√™ salve grupos preenchidos de arquivos de redo log em um ou mais destinos offline (archivelog)
‚ñ∂Ô∏è  O processo de transformar arquivos de redo log em arquivos de archived redo log √© chamado de arquivamento.
‚ñ∂Ô∏è  Esse processo s√≥ √© poss√≠vel se o banco de dados estiver operando no modo ARCHIVELOG.
‚ñ∂Ô∏è  Um archivelog √© uma c√≥pia do redo log
‚ñ∂Ô∏è  √â extremamente recomend√°vel que ambientes produtivos estejam com o archivelog ativado
‚ñ∂Ô∏è  √â poss√≠vel ativar o archive log durante a cria√ß√£o do banco de dados ou ap√≥s a sua cria√ß√£o
‚ñ∂Ô∏è  Caso queira ativar o archivelog, ap√≥s o banco criado, √© necess√°rio reiniciar o banco de dados


=================================================================
== NOARCHIVELOG e ARCHIVELOG
=================================================================
‚ñ∂Ô∏è NOARCHIVELOG Mode:
  ‚ñ´Ô∏è N√£o √© poss√≠vel fazer backups online
  ‚ñ´Ô∏è Desativa o arquivamento do redo log.
  ‚ñ´Ô∏è N√£o √© poss√≠vel realizar backups de tablespaces online.
  ‚ñ´Ô∏è N√£o √© poss√≠vel realizar uma recupera√ß√£o at√© o ponto da falha
  üíÄ Viva perigosamennte
‚ñ∂Ô∏è ARCHIVELOG Mode:
  ‚ñ´Ô∏è Ativa o arquivamento do redo log.
  ‚ñ´Ô∏è √â poss√≠vel realizar uma recupera√ß√£o at√© o ponto da falha
  ‚ñ´Ô∏è Permite manter um banco de dados standby atualizado.


=================================================================
== Definindo o destino dos archives 
=================================================================
‚ñ∂Ô∏è O par√¢metro LOG_ARCHIVE_DEST_n define o caminho que os archives ficar√£o armazenados
‚ñ∂Ô∏è Sempre que poss√≠vel, procure manter os archives em um disco especif√≠co para arquivos de backup
‚ñ∂Ô∏è Voc√™ pode definir multiplas localidades para o archive log:
  ‚ñ´Ô∏è LOG_ARCHIVE_DEST_1 = 'LOCATION=/disk1/arc'
  ‚ñ´Ô∏è LOG_ARCHIVE_DEST_2 = 'LOCATION=/disk2/arc'
  ‚ñ´Ô∏è LOG_ARCHIVE_DEST_3 = 'SERVICE=standby1'
  ‚ñ´Ô∏è LOG_ARCHIVE_DEST_4 = 'LOCATION=USE_DB_RECOVERY_FILE_DEST'

=================================================================
== Formatando o nome do arquivo  
=================================================================
‚ñ∂Ô∏è Voc√™ pode definir o nome do arquivo atrav√©s da vari√°vel LOG_ARCHIVE_FORMAT
  ‚ñ´Ô∏è %s log sequence number
  ‚ñ´Ô∏è %S log sequence number, zero filled
  ‚ñ´Ô∏è %t thread number
  ‚ñ´Ô∏è %T thread number, zero filled
  ‚ñ´Ô∏è %a activation ID
  ‚ñ´Ô∏è %d database ID
  ‚ñ´Ô∏è %r resetlogs ID that ensures unique names are constructed for the archived log files across multiple incarnations of the database


=================================================================
== Ativando o archivelog
=================================================================
-- Formatando o nome do archivelog
SQL> alter system set log_archive_format='arc_%t_%s_%r.arc' scope=spfile;

-- Definindo o destino do archivelog
SQL> alter system set log_archive_dest_1='location=USE_DB_RECOVERY_FILE_DEST' scope=spfile;

-- Ativando o Archivelog
SQL> shutdown immediate;
SQL> startup mount;
SQL> alter database archivelog;
SQL> alter database open;

ALTER SYSTEM ARCHIVE LOG ALL;
SELECT GROUP#, STATUS, ARCHIVED, SEQUENCE# FROM V$LOG;
/backup/ORCL/archivelog/2025_07_15

-- Verificando o archivelog
SQL> archive log list;
SQL> show parameter log_archive_format;
SQL> show parameter log_archive_dest_1;
SQL> show parameter db_recovery_file_dest;

-- Testando a gera√ß√£o dos archives
SQL> alter system switch logfile;
SQL> alter system switch logfile;
SQL> alter system switch logfile;
SQL> exit;

$ ls -lhtr /backup/${ORACLE_SID}/archivelog/

=================================================================
== Responsabilidades do DBA
=================================================================
‚ÄºÔ∏è Monitorar o espa√ßo em disco ocupado pelos archives
‚ÄºÔ∏è Monitorar o espa√ßo na FRA ocupado pelos archives
‚ÄºÔ∏è Realizar backups dos archives
‚ÄºÔ∏è Excluir archives ap√≥s envio para o destino (backup ou standby)


=================================================================
== üéØ Conclus√£o
=================================================================
üí° Os Archived Logs s√£o crucias para a estrat√©gia de backup e recupera√ß√£o
üí° Pratique colocar o banco de dados archived log