|-------------------------------------------------------------------------------|
| Aula      : Identifique problemas de performance com o oratop				     |
| MÃ³dulo    : IntroducÌ§aÌƒo a performance e tuning                                 |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| ReferÃªncia: 
|-------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Aprender a analisar a performance do banco de dados com a ferramenta oratop


=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ SessÃµes do oratop
ğŸ“ Executando o oratop
ğŸ“ O que pode ser monitorado pelo oratop
ğŸ“ InformaÃ§Ãµes chaves
ğŸ“ ParÃ¢metros Ãºteis
ğŸ“ Exemplo prÃ¡tico 1
ğŸ“ SessÃ£o 1: InformaÃ§Ãµes sobre o Database
ğŸ“ SessÃ£o 1: InformaÃ§Ãµes sobre a instÃ¢ncia
ğŸ“ SessÃ£o 3: Top 5 Events (ordenado por event wait time desc)
ğŸ“ SessÃ£o 4: Processos ativos (ordenado por event wait time desc)
ğŸ“ ConclusÃ£o


=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ Ã‰ uma Ã³tima ferramenta para anÃ¡lisar o que estÃ¡ ocorrendo no banco (presente)
â–¶ï¸ Tem muitas funcionalidades
â–¶ï¸ Ã‰ instalado junto com o Oracle, desde a versÃ£o 12c r2
	â–«ï¸ Antes da versÃ£o 12c r2, vocÃª presisava baixar do MOS, mas Ã© apenas um executÃ¡vel, bem simples
â–¶ï¸ Na minha opniÃ£o Ã© o melhor recurso para saber o que estÃ¡ acontecendo com o banco em tempo real
ğŸ‰ Funciona no Standard Edition


=================================================================
== ğŸ¯ SessÃµes do oratop
=================================================================
â–¶ï¸ O oratop tem 4 Ã¡reas:	
	â–«ï¸ InformaÃ§Ãµes gerais do database
	â–«ï¸ Atividade da instÃ¢ncia
	â–«ï¸ Top Events
	â–«ï¸ Sql mais pesados


=================================================================
== ğŸ¯ Executando o oratop
=================================================================
â–¶ï¸ Ã‰ muito similar ao uso do sqlplus, sqlcl...
â–¶ï¸ VocÃª precisa definir as variÃ¡veis de ambiente do banco que vocÃª vai analisar

$ . oraenv
$ $ORACLE_HOME/suptools/oratop/oratop -rf / as sysdba


=================================================================
== ğŸ¯ O que pode ser monitorado pelo oratop
=================================================================
â–¶ï¸ InformaÃ§Ãµes sobre performance do banco
â–¶ï¸ Consumo de CPU
â–¶ï¸ Bloqueios no banco de dados
â–¶ï¸ Tablespaces
â–¶ï¸ OcupaÃ§Ã£o no ASM
â–¶ï¸ Monitora todas as instÃ¢ncias do cluster de uma Ãºnica vez
ğŸ’¡ Eventualmente o oratop destaca alguns itens em vermelho como um "Warning"



=================================================================
== ğŸ¯ InformaÃ§Ãµes chaves
=================================================================
â–¶ï¸ O oratop tem muitas informaÃ§Ãµes, vocÃª nÃ£o vai conseguir "decorar" tudo
â–¶ï¸ PorÃ©m hÃ¡ algumas informaÃ§Ãµes que sÃ£o chaves para vocÃª diagnosticar se o ambiente estÃ¡ com problemas
â–¶ï¸ SessÃ£o 1: Database:
	â–«ï¸ %db		:Atividade do banco de dados em %
â–¶ï¸ SessÃ£o 2: Instance
	â–«ï¸ %CPU		: UtilizaÃ§Ã£o da CPU em %
	â–«ï¸ %DCP		: UtilizaÃ§Ã£o da CPU em % pelo database
	â–«ï¸ LOAD		: Load do banco de dados
	â–«ï¸ AAS		: Average Active Sessions
	â–«ï¸ ASC		: Active Sessions que estÃ¡ em CPU 
	â–«ï¸ ASI		: Active Sessions que estÃ¡ aguardando I/O
	â–«ï¸ ASW		: Active Sessions que estÃ¡ aguardando outros eventos


=================================================================
== ğŸ¯ ParÃ¢metros Ãºteis
=================================================================
-f FUll
-i5 Intervalo em segundos (5 segundos, por exemplo)
-r Real Time


=================================================================
== ğŸ¯ Exemplo prÃ¡tico 1
=================================================================
-- SessÃ£o 1: Como root, executar o swingbench para gerar um load no banco
# cd /u01/swingbenchlatest/swingbench/bin/
# ./charbench -uc 10 -cs //localhost/orcl -c ../configs/SOE_Server_Side_V2.xml -u SOE -p SOE -parallel 2

-- SessÃ£o 2: 
$ . oraenv
$ $ORACLE_HOME/suptools/oratop/oratop -rf / as sysdba


=================================================================
== ğŸ¯ SessÃ£o 1: InformaÃ§Ãµes sobre o Database
=================================================================
   Version        : Oracle major version
   db name        : db_unique_name
   time           : time as of the most recent stats (hh24:mi:ss)
   up             : database uptime (UTC)
   ins            : total number of instance(s)
   sn             : total user sessions (non-predefined)
   us             : number of distinct users (non-predefined)
   sga            : system global area (SGA)
   %db            : %Active Database (work)       


=================================================================
== ğŸ¯ SessÃ£o 2: InformaÃ§Ãµes sobre a instÃ¢ncia
=================================================================
   ID             : Instance Id.
   %CPU           : Host CPU Utilization (%busy)
   %DCP           : Database cpu usage as %CPU
   LOAD           : Current OS Load
   AAS            : Average Active Sessions (dbtime (s/s))
   ASC            : Active Sessions on CPU
   ASI            : Active Sessions waiting on User I/O
   ASW            : Active Sessions Waiting on other events
   IDL            : Idle User Sessions (non-predefined)
   MBPS           : I/O Megabytes per Second (throughput R/W)
   %FR            : Shared Pool Free %
   PGA            : Total PGA Allocated
   UTPS           : User Transaction Per Sec
   RT/X           : Response Time Per Txn
   DCTR           : Database CPU Time Ratio
   DWTR           : Database Wait Time Ratio


=================================================================
== ğŸ¯ SessÃ£o 3: Top 5 Events (ordenado por event wait time desc) 
=================================================================
  EVENT           : wait event name
        (RT)      : Real-Time mode
  TOTAL WAITS     : total waits
  TIME(s)         : total wait time in seconds)
  AVG_MS          : average wait time in milliseconds
  PCT             : percent of wait time (all events)
  WAIT_CLASS      : name of the wait class


=================================================================
== ğŸ¯ SessÃ£o 4: Processos ativos (ordenado por event wait time desc) 
=================================================================
   ID             : inst_id
   SID            : session identifier
   SPID           : oraserver process os id
   USR            : user name
   PROG           : process program name
   S              : SERVER (dedicated, shared, etc.)
   PGA            : pga_used_mem
   SQL_ID/BLOCKER : sql_id or the final blocker's (inst:sid)
   OPN            : operation name, e.g. select
   E/T            : session elapsed time (active/inactive)
   STA            : ACTive|INActive|KILled|CAChed|SNIped
   STE            : process state, e.g. on CPU or user I/O or WAIting
   EVENT/*LA      : session wait event name. Auto toggle with (*latch name)
   W/T            : event wait time (Threshold: 1s)


=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ Ã‰ uma ferramenta poderosa, domine-a e vocÃª jÃ¡ serÃ¡ capaz de fazer muitos troubleshooting no banco
ğŸ’¡ VocÃª precisa colocar o oratop na sua "caixa de ferramentas"
ğŸ’¡ A prÃ¡tica Ã© a mÃ£e da perfeiÃ§Ã£o, faÃ§a muitos laboratÃ³rios
ğŸ’¡ FaÃ§a os testes efetuados nessa aula
ğŸ’¡ AlguÃ©m gritou "O banco estÃ¡ lento!"... O oratop responde!
ğŸ’¡ Sempre que tiver oportunidade no dia a dia, use o oratop para praticar!