|-------------------------------------------------------------------------------|
| Aula      : Data Pump Import																  |
| MÃ³dulo    : Managing Oracle Database                                          |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/sutil/datapump-import-utility.html#GUID-D11E340E-14C6-43B8-AB09-6335F0C1F71B
|-------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Aprender o que Ã© e como usar o Data Pump Import


=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ Cuidados
ğŸ“ EstratÃ©gia
ğŸ“ Levantamento de requisitos
ğŸ“ Criando o diretÃ³rio no destino
ğŸ“ Verificando as tablespaces no banco de origem
ğŸ“ Fazendo backup na origem
ğŸ“ Transferindo o dump para o servidor de destino
ğŸ“ Criando as tablespaces necessÃ¡rias no destino
ğŸ“ Testando a conexÃ£o
ğŸ“ Importando o schema
ğŸ“ Importando o schema com outro nome (REMAP_SCHEMA)
ğŸ“ Importando apenas objetos especÃ­ficos (INCLUDE)
ğŸ“ Excluindo tipos de objeto (EXCLUDE)
ğŸ“ Importando apenas tabelas especÃ­ficas (TABLES)
ğŸ“ Importando com paralelismo (PARALLEL)
ğŸ“ Sobrescrevendo tabelas existentes
ğŸ“ Importando somente a estrutura (sem linhas)
ğŸ“ Importando para outra tablespace
ğŸ“ ConclusÃ£o


=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ O Data Pump Import Ã© usado para carregar no banco dados e metadados
â–¶ï¸ O Data Pump Import pode importar dados a partir:
	â–«ï¸ Dump gerado pelo expdp
	â–«ï¸ Diretamente a partir de outro banco de dados
â–¶ï¸ A maioria dos parÃ¢metros do Data Pump Export sÃ£o compatÃ­veis com o impdp


=================================================================
== ğŸ¯ Cuidados 
=================================================================
âš ï¸ Fique atento na string de conexÃ£o a ser utilizada
âš ï¸ Saiba exatamente o que vocÃª deseja importar
âš ï¸ Prepare os scripts em um bloco de notas
âš ï¸ Revise os scripts
âš ï¸ Ao exportar os dados, gere o dump somente com o que vocÃª precisa


=================================================================
== ğŸ¯ EstratÃ©gia
=================================================================
ğŸ¯ Fazer backup do schema SOE no servidor de origem
ğŸ¯ Transferir o dump para o servidor de destino
ğŸ¯ Restaurar dump no servidor de destino


=================================================================
== ğŸ¯ Levantamento de requisitos
=================================================================
âš ï¸ Tem espaÃ§o no servidor de destino? 
âš ï¸ Quem solicitou, tem autorizaÃ§Ã£o? 
âš ï¸ Qual o horÃ¡rio mais adequado para realizar a tarefa?  
âš ï¸ Tem que comunicar alguÃ©m?
âš ï¸ O schema existe no banco de destino? Caso exista, pode sobrescrever?
âš ï¸ As tablespaces existem no banco de destino? 
âš ï¸ Quem terÃ¡ acesso a este ambiente? Quais serÃ£o os acessos? 


=================================================================
== ğŸ¯ Criando o diretÃ³rio no destino
=================================================================
$ mkdir /tmp/data_pump
$ sqlplus / as sysdba

SQL> create or replace directory dir_bkp as '/tmp/data_pump';


=================================================================
== ğŸ¯ Verificando as tablespaces no banco de origem
=================================================================
$ sqlplus / as sysdba

SQL> set lines 1000
SQL> select tablespace_name, count(1), sum(bytes/1024/1024) size_mb
from dba_segments
where owner = 'SOE'
group by tablespace_name;

SQL> col username form a20
SQL> col default_tablespace form a25
SQL> select username, default_tablespace from dba_users where username ='SOE';


=================================================================
== ğŸ¯ Fazendo backup na origem
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1"@orcl directory=dir_bkp dumpfile=SOE.dmp logfile=SOE.log schemas=SOE parallel=4


=================================================================
== ğŸ¯ Transferindo o dump para o servidor de destino
=================================================================
$ scp /tmp/data_pump/SOE.* oracle@192.168.68.114:/tmp/data_pump/


=================================================================
== ğŸ¯ Criando as tablespaces necessÃ¡rias no destino
=================================================================
$ . oraenv 
$ sqlplus / as sysdba

SQL> show parameter db_create_file_dest;
SQL> !df -h

SQL> create tablespace TS_SOE datafile size 1g 
     autoextend on next 1g maxsize 5g;


=================================================================
== ğŸ¯ Testando a conexÃ£o
=================================================================
âš ï¸ FaÃ§a o teste com o usuÃ¡rio que irÃ¡ realizar a operaÃ§Ã£o de import

$ sqlplus system/"Wellcome1"@dev
SQL> col instance_name form a15
SQL> col host_name form a20
SQL> select instance_name, host_name from v$instance;

=================================================================
== ğŸ¯ Importando o schema
=================================================================
$ export ORACLE_SID=dev

$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp logfile=SOE_IMP.log schemas=SOE


=================================================================
== ğŸ¯ Importando o schema com outro nome (REMAP_SCHEMA)
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp logfile=SOE_IMP.log schemas=SOE remap_schema=SOE:SOE_TESTE


=================================================================
== ğŸ¯ Importando apenas objetos especÃ­ficos (INCLUDE)
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp INCLUDE=USER,TABLESPACE_QUOTA logfile=SOE_IMP.log remap_schema=SOE:SOE_TESTE  parallel=4


=================================================================
== ğŸ¯ Excluindo tipos de objeto (EXCLUDE)
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp EXCLUDE=CONSTRAINT,REF_CONSTRAINT logfile=SOE_IMP.log remap_schema=SOE:SOE_TESTE  parallel=4


=================================================================
== ğŸ¯ Importando apenas tabelas especÃ­ficas (TABLES)
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp tables=SOE.INVENTORIES,SOE.PRODUCT_INFORMATION,SOE.WAREHOUSES logfile=SOE_IMP.log remap_schema=SOE:SOE_TESTE  parallel=4


=================================================================
== ğŸ¯ Importando com paralelismo (PARALLEL)
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp tables=SOE.INVENTORIES,SOE.PRODUCT_INFORMATION,SOE.WAREHOUSES logfile=SOE_IMP.log remap_schema=SOE:SOE_TESTE  PARALLEL=2


=================================================================
== ğŸ¯ Sobrescrevendo tabelas existentes
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp tables=SOE.LOGON logfile=SOE_IMP.log remap_schema=SOE:SOE_TESTE  PARALLEL=2 TABLE_EXISTS_ACTION=TRUNCATE
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp tables=SOE.LOGON logfile=SOE_IMP.log remap_schema=SOE:SOE_TESTE  PARALLEL=2 TABLE_EXISTS_ACTION=REPLACE


=================================================================
== ğŸ¯ Importando somente a estrutura (sem linhas)
=================================================================
$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp logfile=SOE_IMP.log schemas=SOE CONTENT=METADATA_ONLY


=================================================================
== ğŸ¯ Importando para outra tablespace
=================================================================
$ sqlplus / as sysdba
SQL> create tablespace TS_SOE_DEV;
SQL> exit


$ impdp  system/"Wellcome1"@dev directory=dir_bkp  dumpfile=SOE.dmp logfile=SOE_IMP.log schemas=SOE remap_schema=SOE:SOE_TESTE remap_tablespace=TS_SOE:TS_SOE_DEV PARALLEL=4


$ sqlplus / as sysdba

SQL> select tablespace_name, count(1) 
from dba_segments 
where owner = 'SOE_TESTE' 
group by tablespace_name;



=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ Um DBA precisa dominar o Data Pump
ğŸ’¡ Ã‰ uma atividade muito corriqueira mover dados, vocÃª precisar saber fazer com facilidade
ğŸ’¡ Pratique a exaustÃ£o as liÃ§Ãµes dessa aula
ğŸ’¡ Abordei os parÃ¢metros mais utilizados, mas nÃ£o abordei todos
ğŸ’¡ Tente escrever os comandos para fixar, nÃ£o copie e cole
ğŸ’¡ Mas nÃ£o se preocupe em decorar tudo, salve na sua pasta de howto como usar o datapump
ğŸ’¡ Sua missÃ£o Ã© compreender 