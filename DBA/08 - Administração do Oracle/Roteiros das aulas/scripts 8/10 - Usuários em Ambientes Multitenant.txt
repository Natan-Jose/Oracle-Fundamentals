|-------------------------------------------------------------------------------|
| Aula      : UsuÃ¡rios em Ambientes Multitenant								|
| MÃ³dulo    : Managing Oracle Database                                          |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/multi/overview-of-the-multitenant-architecture.html#GUID-B14FD999-8FB2-428E-9122-BCB55DE516B8
|-------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Entender como funciona a criaÃ§Ã£o e manutenÃ§Ã£o de usuÃ¡rios em ambientes Multitenant


=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ UsuÃ¡rio Local
ğŸ“ riaÃ§Ã£o de UsuÃ¡rios Comuns
ğŸ“ Concedendo PrivilÃ©gios e Roles
ğŸ“ Criando e Concedendo Roles
ğŸ“ ConclusÃ£o

=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ Em ambientes multitenant, temos dois tipos de usuÃ¡rio:
	â–«ï¸ LOCAL
	â–«ï¸ COMMON
â–¶ï¸ Cada PDB possui seu prÃ³prio dicionÃ¡rio de dados
â–¶ï¸ Os usuÃ¡rios locais se registram no dicionÃ¡rio da PDB
â–¶ï¸ Os usuÃ¡rios comuns se registram no dicionÃ¡rio do "CDB$ROOT"

https://docs.oracle.com/en/database/oracle/oracle-database/19/multi/img/cncpt340.png

=================================================================
== ğŸ¯ UsuÃ¡rio Local
=================================================================
â–¶ï¸ SÃ³ existe dentro do PDB
ğŸ’¡ Ã‰ exatamente igual ao usuÃ¡rio de um ambiente non container

$ sqlplus / as sysdba
SQL> alter session set container = PDB1;

-- Criar um usuÃ¡rio local
CREATE USER local_user IDENTIFIED BY password;

-- Conceder privilÃ©gios ao usuÃ¡rio local
GRANT CREATE SESSION TO local_user;


-- Listar usuÃ¡rios no PDB
SQL> SELECT username FROM dba_users where username = 'LOCAL_USER';

SQL> @users created


=================================================================
== ğŸ¯ CriaÃ§Ã£o de UsuÃ¡rios Comuns
=================================================================
â–¶ï¸ Criados no CDB root e tÃªm acesso a todos os PDBs
â–¶ï¸ Podem acessar todos os PDBs dentro do CDB
âš ï¸ Devem ter o prefixo â€œC##â€ no nome

$ sqlplus / as sysdba
SQL> alter session set container = cdb$root;

-- Criar um usuÃ¡rio comum
SQL> CREATE USER C##common_user IDENTIFIED BY password;

-- Conceder privilÃ©gios ao usuÃ¡rio comum
SQL> GRANT CREATE SESSION TO C##common_user CONTAINER=ALL;

-- Listar usuÃ¡rios no CDB root
SQL> SELECT username FROM cdb_users WHERE common='YES';

SQL> @users created


=================================================================
== ğŸ¯ Concedendo PrivilÃ©gios e Roles
=================================================================
-- Conceder privilÃ©gios a um usuÃ¡rio local
SQL> alter session set container = pdb1;
SQL> GRANT CREATE SESSION TO local_user;

-- Conceder privilÃ©gios a um usuÃ¡rio comum em todos os containers
SQL> alter session set container = cdb$root;
SQL> GRANT CREATE SESSION TO C##common_user CONTAINER=ALL;

=================================================================
== ğŸ¯ Criando e Concedendo Roles
=================================================================
-- Conectar ao CDB root como sysdba
$ sqlplus / as sysdba
SQL> alter session set container = cdb$root;

-- Criar uma role comum
SQL> CREATE ROLE C##common_role CONTAINER=ALL;

-- Conceder privilÃ©gios Ã  role comum
SQL> GRANT CREATE TABLE TO C##common_role CONTAINER=ALL;

-- Conceder a role a um usuÃ¡rio comum
SQL> GRANT C##common_role TO C##common_user CONTAINER=ALL;


=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ O assunto de criaÃ§Ã£o e gerenciamento de usuÃ¡rios em ambientes multitentant Ã© amplo
ğŸ’¡ Abordei os princÃ­pios bÃ¡sicos do gerenciamento de usuÃ¡rios
ğŸ’¡ Se o seu ambiente for multitenant e vocÃª precisar de mais conhecimento, consulte o link de referÃªncia da aula

 