|-------------------------------------------------------------------------------|
| Aula      : Data Pump Export																  |
| MÃ³dulo    : Managing Oracle Database                                          |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/sutil/oracle-data-pump-overview.html#GUID-17FAE261-0972-4220-A2E4-44D479F519D4
|-------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Aprender o que Ã© e como usar o Data Pump Export


=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ O Data Pump no dia a dia do DBA
ğŸ“ Principais utilidades
ğŸ“ O que Ã© o Data Pump Export
ğŸ“ Modos de exportaÃ§Ã£o de dados
ğŸ“ LocalizaÃ§Ã£o dos Dump Files
ğŸ“ PrivilÃ©gios para utilizar o Data Pump Export
ğŸ“ Criando um directory no Banco de dados
ğŸ“ A estrutura bÃ¡sica do comando expdp
ğŸ“ Export Full
ğŸ“ Export de um schema
ğŸ“ Export de tabelas especÃ­ficas
ğŸ“ Export com paralelismo
ğŸ“ Export com compress
ğŸ“ Export com retro compatibilidade
ğŸ“ Export de objetos especÃ­ficos
ğŸ“ Export excluindo objetos especÃ­ficos
ğŸ“ Export sem incluir as linhas
ğŸ“ Usando o Data Pump export em ambientes multitenant
ğŸ“ Usando o Data Pump export em ambientes Oracle RAC
ğŸ“ ConclusÃ£o

=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ Ã‰ uma tecnologia para mover dados de forma eficiente dentro ou entre bancos de dados Oracle
â–¶ï¸ Expdp e Impdp SÃ£o os utilitÃ¡rios que formam o Oracle Data Pump
	â–«ï¸ Expdp Ã© utilizado para exportar dados --> lÃª do banco e grava no arquivo.
	â–«ï¸ Impdp Ã© usado para importar dados     --> lÃª do arquivo e grava no banco. 


=================================================================
== ğŸ¯ O Data Pump no dia a dia do DBA
=================================================================
â–¶ï¸ VocÃª precisa dominar o uso do Data Pump, farÃ¡ parte do seu dia a dia
â–¶ï¸ HaverÃ£o muitos pedidos de replicaÃ§Ã£o de dados
â–¶ï¸ Saiba utilizar os seus principais recursos
â–¶ï¸ Treine bastante que vocÃª terÃ¡ seguranÃ§a para usar em produÃ§Ã£o


=================================================================
== ğŸ¯ Principais utilidades
=================================================================
â–¶ï¸ Replicar dados entre plataformas diferentes
â–¶ï¸ Replicar dados entre versÃµes diferentes
â–¶ï¸ Replicar dados de forma parcial
â–¶ï¸ MigraÃ§Ã£o de versÃ£o (para bases simples e pequenas)


=================================================================
== ğŸ¯ O que Ã© o Data Pump Export
=================================================================
â–¶ï¸ O Data Pump Export Ã© usado para copiar do banco, dados e metadados dentro de um ou mais arquivos no SO, chamados de "Dump Files"
â–¶ï¸ O Dump File contÃ©m:
	â–«ï¸ Dados das tabelas
	â–«ï¸ Metadados
	â–«ï¸ InformaÃ§Ãµes de controles
â–¶ï¸ Os arquivos do Data Pump sÃ£o escritos num formato binÃ¡rio proprietÃ¡rio da Oracle
â–¶ï¸ VocÃª pode importar o dump file usando o Data Pump Import
â–¶ï¸ VocÃª pode invocar o Data Pump export atravÃ©s da linha de comando, atravÃ©s do comando "expdp" ou via API


=================================================================
== ğŸ¯ Modos de exportaÃ§Ã£o de dados
=================================================================
â–¶ï¸ VocÃª pode exportar os dados de 5 maneiras diferentes:
	â–«ï¸ Full Mode (Eventualmente utilizado)
	â–«ï¸ Schema Mode (Muito utilizado)
	â–«ï¸ Table Mode (Muito utilizado)
	â–«ï¸ Tablespace Mode (Raramente utilizado)
	â–«ï¸ Transportable Tablespace Mode (Raramente utilizado)


=================================================================
== ğŸ¯ LocalizaÃ§Ã£o dos Dump Files
=================================================================
â–¶ï¸ Para usar o Data Pump, vocÃª precisar criar um directory no banco
ğŸ’¡ Directory Ã© um objeto no banco, Ã© diferente do diretÃ³rio do SO. Uma coisa Ã© uma coisa, outra coisa Ã© outra coisa!
â–¶ï¸ Os arquivos sÃ£o sempre gerados no servidor


=================================================================
== ğŸ¯ PrivilÃ©gios para utilizar o Data Pump Export
=================================================================
â–¶ï¸ Ã‰ preciso ter privilÃ©gios de exp_full_database ou sysdba para exportar os dados com o Data Pump


=================================================================
== ğŸ¯ Criando um directory no Banco de dados
=================================================================
â–¶ï¸ VocÃª precisa de permissÃµes CREATE ANY DIRECTORY no banco
â–¶ï¸ O usuÃ¡rio oracle precisa de permissÃµes de leitura e gravaÃ§Ã£o no diretÃ³rio do S.O.
â–¶ï¸ Certifique-se que haja espaÃ§o no file system 


$ mkdir /tmp/data_pump
$ . oraenv

SQL> create or replace directory dir_bkp as '/tmp/data_pump';


=================================================================
== ğŸ¯ A estrutura bÃ¡sica do comando expdp
=================================================================
$ expdp system/"Wellcome1"@orcl directory=dir_bkp dumpfile=soe.dmp logfile=soe.log schemas=SOE
â–¶ï¸ Quando vocÃª usa o expdp, por padrÃ£o vocÃª "sempre" precisa definir:
   â–«ï¸ A string de conexÃ£o
   â–«ï¸ O diretÃ³rio
   â–«ï¸ O nome do dumpfile
   â–«ï¸ O nome do logfile
   â–«ï¸ O modo de exportaÃ§Ã£o (Normalmente, full, schemas ou tables)
â–¶ï¸ AlÃ©m desses parÃ¢metros hÃ¡ uma infinidade de outros

$ expdp help=y

=================================================================
== ğŸ¯ Export Full
=================================================================
$ expdp system/"Wellcome1"@orcl directory=dir_bkp dumpfile=orcl_full.dmp logfile=orcl_full.log FULL=Y
$ ls -lhtr /tmp/data_pump/

âš ï¸ Caso o export full seja executado em um container root, ele nÃ£o vai incluir no dump os PDBS

=================================================================
== ğŸ¯ Export de um schema
=================================================================
$ export ORACLE_SID=ORCL
$ expdp system@orcl directory=dir_bkp  dumpfile=SOE.dmp logfile=SOE.log schemas=SOE


=================================================================
== ğŸ¯ Export de tabelas especÃ­ficas
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1" directory=dir_bkp dumpfile=WAREHOUSES.dmp logfile=WAREHOUSES.log tables=SOE.WAREHOUSES
$ expdp system/"Wellcome1"@orcl directory=dir_bkp dumpfile=tables.dmp logfile=tables.log tables=SOE.WAREHOUSES,SOE.CUSTOMERS


=================================================================
== ğŸ¯ Export com paralelismo
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=SOE_PARALLEL.dmp logfile=SOE_PARALLEL.log schemas=SOE PARALLEL=2

=================================================================
== ğŸ¯ Export com compress
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=SOE_COMPRESS.dmp logfile=SOE_COMPRESS.log schemas=SOE PARALLEL=2 COMPRESSION=ALL


=================================================================
== ğŸ¯ Export com retro compatibilidade
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=SOE_12c.dmp logfile=SOE_12c.log schemas=SOE PARALLEL=2 version=12.2


=================================================================
== ğŸ¯ Export de objetos especÃ­ficos
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=SOE_INDEX.dmp logfile=SOE_INDEX.log schemas=SOE PARALLEL=2 INCLUDE=INDEX


$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=muitos_obejtos.dmp logfile=muitos_obejtos.log schemas=SOE PARALLEL=2 INCLUDE=SEQUENCE,PACKAGE_SPEC,VIEW,CONSTRAINT,REF_CONSTRAINT



ğŸ’¡ ParÃ¢metros possÃ­veis no include

SQL> col OBJECT_PATH form a70
SQL> col COMMENTS form a80
SQL> set lines 1000
SQL> select * From DATABASE_EXPORT_OBJECTS order by 1;

ğŸ’¡ VocÃª tambÃ©m pode consultar o log de exportaÃ§Ã£o que dÃ¡ dicas!


=================================================================
== ğŸ¯ Export excluindo objetos especÃ­ficos
=================================================================
$ export ORACLE_SID=orcl
$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=SOE_EXCLUDE.dmp logfile=SOE_EXCLUDE.log schemas=SOE PARALLEL=2 EXCLUDE=TABLE


=================================================================
== ğŸ¯ Export sem incluir as linhas
=================================================================
$ export ORACLE_SID=ORCL
$ expdp system/"Wellcome1"@orcl directory=dir_bkp  dumpfile=SOE_METADATA_ONLY.dmp logfile=SOE_METADATA_ONLY.log schemas=SOE PARALLEL=2 CONTENT=METADATA_ONLY


=================================================================
== ğŸ¯ Usando o Data Pump export em ambientes multitenant
=================================================================
ğŸ’¡ NÃ£o muda nada. As mesmas variÃ¡veis que vocÃª exporta para se conectar via sqlplus, vocÃª usa para gerar o datapump export
ğŸ’¡ SÃ³ fique atento as variÃ¡veis e ao usuÃ¡rio

$ export ORACLE_SID=cdb1
$ export ORACLE_PDB_SID=pdb1
$ sqlplus / as sysdba
SQL> create or replace directory dir_bkp as '/tmp/data_pump';
SQL> exit

$ expdp system/"Wellcome1" directory=dir_bkp dumpfile=pdb_full.dmp logfile=pdb_full.log FULL=Y CONTENT=METADATA_ONLY


=================================================================
== ğŸ¯ Usando o Data Pump export em ambientes Oracle RAC
=================================================================
ğŸ’¡ VocÃª tambÃ©m precisa se preocupar em exportar as variÃ¡veis que vocÃª exporta para se conectar via sqlplus 
ğŸ’¡ SÃ³ fique atento que o nome da instÃ¢ncia nÃ£o Ã© o nome do database
âš ï¸ Quando vocÃª faz export em RAC com paralelismo, ele vai criar processos em todas as instÃ¢ncias
âš ï¸ Neste caso, o servidor precisaria ter um file system "clusterizado"
âš ï¸ Caso nÃ£o tenha, use o parÃ¢metro CLUSTER=N


$ export ORACLE_SID=rac1
$ export ORACLE_PDB_SID=pdb1
$ sqlplus / as sysdba
SQL> create or replace directory dir_bkp as '/tmp/data_pump';
SQL> exit

$ expdp system/"Wellcome1" directory=dir_bkp dumpfile=pdb_full.dmp logfile=pdb_full.log FULL=Y CLUSTER=N



=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ Um DBA precisa dominar o Data Pump
ğŸ’¡ Ã‰ uma atividade muito corriqueira mover dados, vocÃª precisar saber fazer com facilidade
ğŸ’¡ Pratique a exaustÃ£o as liÃ§Ãµes dessa aula
ğŸ’¡ Abordei os parÃ¢metros mais utilizados, mas nÃ£o abordei todos
ğŸ’¡ Tente escrever os comandos para fixar, nÃ£o copie e cole
ğŸ’¡ Mas nÃ£o se preocupe em decorar tudo, salve na sua pasta de howto como usar o datapump
 