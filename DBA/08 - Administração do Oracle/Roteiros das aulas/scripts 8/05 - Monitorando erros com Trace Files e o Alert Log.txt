|-------------------------------------------------------------------------------|
| Aula      : Monitorando erros com Trace Files e o Alert Log                   |
| MÃ³dulo    : Managing Oracle Database                                          |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/admin/monitoring-the-database.html#GUID-B4D1E84B-107C-42AE-82F6-7A2D603B6C84
|-------------------------------------------------------------------------------|




=================================================================
== ðŸŽ¯ Objetivos da Aula:
=================================================================
ðŸ’¡ Entender o que Ã© o alert.log e sua importÃ¢ncia
ðŸ’¡ Saber como consultar o arquivo de log


=================================================================
== ðŸŽ¯ Resumo
=================================================================
ðŸ“ IntroduÃ§Ã£o
ðŸ“ O que sÃ£o os Alert Logs?
ðŸ“ O que sÃ£o os Trace Files?
ðŸ“ ForÃ§ando um erro no alert
ðŸ“ LocalizaÃ§Ã£o do Alert Log e dos Trace Files
ðŸ“ V$DIAG_ALERT_EXT View
ðŸ“ Monitoramento em tempo real do alert
ðŸ“ Monitoramento do alert via ADRCI


=================================================================
== ðŸŽ¯ IntroduÃ§Ã£o
=================================================================
â–¶ï¸ Ã‰ importante que o banco de dados seja monitorado regularmente
â–¶ï¸ Monitore regularmente o banco de dados, mesmo quando ele estiver operando normalmente
â–¶ï¸ Entender como o banco opera normalmente, ajuda a compreender quando ele estÃ¡ com algum problema.
â–¶ï¸ Sempre que alguÃ©m reclamar do banco, olhe o alert.log


=================================================================
== ðŸŽ¯ O que sÃ£o os Alert Logs?
=================================================================
â–¶ï¸ Os Alert Logs sÃ£o arquivos que contÃªm informaÃ§Ãµes importantes sobre mensagens de erro e exceÃ§Ãµes que ocorrem durante as operaÃ§Ãµes do banco de dados
â–¶ï¸ Cada instÃ¢ncia do Oracle Database possui um Alert Log.
â–¶ï¸ InformaÃ§Ãµes sÃ£o adicionadas ao arquivo cada vez que a instÃ¢ncia Ã© iniciada.
â–¶ï¸ Se algo der errado com o banco de dados e a causa nÃ£o for imediatamente Ã³bvia, 
â–¶ï¸ o Alert Log Ã© o primeiro lugar a ser verificado.
â–¶ï¸ O Alert Log Ã© nomeado como alert_SID.log.
â–¶ï¸ O alert log tem uma versÃ£o em arquivo de texto e outra xml
â–¶ï¸ EstÃ¡ localizado no diretÃ³rio ADR especificado pelo parÃ¢metro DIAGNOSTIC_DEST.
â–¶ï¸ Os Alert Logs devem ser excluÃ­dos ou arquivados periodicamente


=================================================================
== ðŸŽ¯ O que sÃ£o os Trace Files?
=================================================================
â–¶ï¸ Os Trace Files sÃ£o arquivos usados pelos processos de background do Oracle para registrar ocorrÃªncias, exceÃ§Ãµes de operaÃ§Ãµes de banco de dados e erros.
â–¶ï¸ Os processos de background criam e armazenam Trace Files no diretÃ³rio especificado pelo parÃ¢metro DIAGNOSTIC_DEST.
â–¶ï¸ Em certos casos, uma entrada no alert log pode direcionar para um arquivo de traces com mais detalhes.


=================================================================
== ðŸŽ¯ ForÃ§ando um erro no alert
=================================================================
SQL> EXEC SYS.DBMS_SYSTEM.KSDWRT(2, 'ORA-00600: internal error code, arguments: [2252], [1903], [OracleQuebrado], [], [], [], [], []');
SQL> EXEC SYS.DBMS_SYSTEM.KSDWRT(2, 'ORA-00666: HOJE VOCE NAO VAI DORMIR');


=================================================================
== ðŸŽ¯ LocalizaÃ§Ã£o do Alert Log e dos Trace Files
=================================================================
SQL> set lines 1000
SQL> show parameter DIAGNOSTIC_DEST;
SQL> Col name format a25
SQL> Col value format a70
SQL> Select name, value from v$diag_info;


=================================================================
== ðŸŽ¯ V$DIAG_ALERT_EXT View
=================================================================
SQL> col MESSAGE_TEXT form a200
SQL> col MESSAGE_LEVEL form a12
SQL> set lines 1000
SQL> select to_char(ORIGINATING_TIMESTAMP,'YYYYMMDD-HH24:MI:SS'),
case
  when MESSAGE_LEVEL = 1 then 'Critical'
  when MESSAGE_LEVEL = 2 then 'Severe'
  when MESSAGE_LEVEL = 8 then 'Important'
  when MESSAGE_LEVEL = 16 then 'Normal'
end MESSAGE_LEVEL
, MESSAGE_TEXT
from X$DBGALERTEXT
where ORIGINATING_TIMESTAMP >= (sysdate-1/24) -- Ãºltima hora
and MESSAGE_TEXT like '%ORA-%'
order by RECORD_ID;


=================================================================
== ðŸŽ¯ Monitoramento em tempo real do alert
=================================================================

SQL> show parameter diag;
SQL> cd /u01/app/oracle/diag/rdbms/cdb1/cdb1/trace
SQL> ls -lhtr alert_cdb1.log
SQL> tail -f alert_cdb1.log
vi alert_cdb1.log

-- sessÃ£o 1
$ tail -50f /opt/oracle/diag/rdbms/orclcdb/ORCLCDB/trace/alert_ORCLCDB.log
$ ls -lhtr /opt/oracle/diag/rdbms/orclcdb/ORCLCDB/alert/log.xml

-- sessÃ£o 2
$ sqlplus / as sysdba
SQL> alter system switch logfile;
SQL> shutdown immediate;
SQL> startup;


=================================================================
== ðŸŽ¯ Monitoramento do alert via ADRCI
=================================================================
[oracle@ol8 alert]$ adrci
adrci> show homes
adrci> set home diag/rdbms/orclcdb/ORCLCDB
adrci> show alert;
adrci> show alert -P "MESSAGE_TEXT LIKE '%ORA-%'"
adrci> show alert -tail -f


=================================================================
== ðŸŽ¯ ConclusÃ£o
=================================================================
ðŸ’¡ O alert log Ã© o ponto de partida para investigar problemas no banco de dados
ðŸ’¡ Troubleshooting Ã© um termo legal para investigar problemas

