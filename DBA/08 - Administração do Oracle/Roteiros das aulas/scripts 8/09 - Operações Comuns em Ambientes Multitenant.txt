|-------------------------------------------------------------------------------|
| Aula      : OperaÃ§Ãµes Comuns em Ambientes Multitenant                         |
| MÃ³dulo    : Managing Oracle Database                                          |
| Curso     : Oracle Fundamentals                                               |
| Instrutor : Marcio Mandarino                                                  |
| URL       : mrdba.com.br/oracle_fundamentals                                  |
|-------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/multi/creating-pdbs.html#GUID-9A250D93-5B3B-4643-BE85-F32CC7B0E413
|-------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula:
=================================================================
ğŸ’¡ Saber fazer operaÃ§Ãµes bÃ¡sicas em ambientes Multitenant


=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ Criando PDBs
ğŸ“ Iniciando e Parando PDBs
ğŸ“ Excluindo um PDB
ğŸ“ Clonando um PDB
ğŸ“ ConclusÃ£o

=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ Existem vÃ¡rias tarefas administrativas que podem ser feitas em um PDB, as mais comuns sÃ£o:
	â–«ï¸ Iniciar e parar um PDB
	â–«ï¸ Criar um PDB
	â–«ï¸ Excluir um PDB
	â–«ï¸ Clonar um PDB
	â–«ï¸ Backup & Restore do PBD

=================================================================
== ğŸ¯ Criando PDBs
=================================================================
â–¶ï¸ A criaÃ§Ã£o de PDBs pode ser realizada usando o comando CREATE PLUGGABLE DATABASE.
â–¶ï¸ Existem vÃ¡rias opÃ§Ãµes para criar PDBs:
	â–«ï¸ A partir de um arquivo de template
	â–«ï¸ Clonagem de um PDB existente
	â–«ï¸ Utilizando uma seed PDB 
 

-- Conectar ao CDB como usuÃ¡rio sysdba
$ . oraenv
$ sqlplus / as sysdba
SQL> show con_name

-- Criar um PDB a partir da seed PDB
SQL> CREATE PLUGGABLE DATABASE pdb2 ADMIN USER pdb_admin IDENTIFIED BY "Wellcome1";

SQL> CREATE PLUGGABLE DATABASE pdb3 ADMIN USER pdb_adm IDENTIFIED BY Password1
  CREATE_FILE_DEST='/u03/oradata/';

-- Verificar se o PDB foi criado com sucesso
SQL> SHOW PDBS;

=================================================================
== ğŸ¯ Iniciando e Parando PDBs
=================================================================
â–¶ï¸ Para iniciar um PDB, utilize o comando ALTER PLUGGABLE DATABASE OPEN
SQL> ALTER PLUGGABLE DATABASE pdb2 OPEN;

â–¶ï¸ Para fechar um PDB, use o comando ALTER PLUGGABLE DATABASE CLOSE
SQL> ALTER PLUGGABLE DATABASE pdb2 CLOSE;
SQL> ALTER PLUGGABLE DATABASE pdb3 CLOSE IMMEDIATE;

âš ï¸ VocÃª tambÃ©m pode se conectar no pdb e fazer um startup e shutdown
SQL> alter session set container = pdb1;
SQL> startup;
SQL> shutdown;

ğŸ’¡ VocÃª pode fazer operaÃ§Ãµes em mÃºltiplos PDBS
SQL> ALTER PLUGGABLE DATABASE ALL OPEN;
SQL> ALTER PLUGGABLE DATABASE ALL CLOSE IMMEDIATE;

ğŸ’¡ VocÃª pode fazer operaÃ§Ãµes em mÃºltiplos PDBS, criando exceÃ§Ãµes
SQL> ALTER PLUGGABLE DATABASE ALL EXCEPT pdb2 CLOSE IMMEDIATE;
SQL> ALTER PLUGGABLE DATABASE ALL EXCEPT pdb1 OPEN;


=================================================================
== ğŸ¯ Excluindo um PDB
=================================================================
ğŸ’€ Excluir um PDB remove completamente o banco de dados pluggable do CDB
ğŸ’€ Se for em ambiente real, sempre tenha backup, mesmo quando digam que nÃ£o Ã© necessÃ¡rio
â–¶ï¸ Para excluir um PDB, ele precisa estar fechado

-- Fechar o PDB antes de excluÃ­-lo
SQL> ALTER PLUGGABLE DATABASE pdb2 CLOSE IMMEDIATE;

-- Excluir o PDB, incluindo seus dados
SQL> DROP PLUGGABLE DATABASE pdb2 INCLUDING DATAFILES;


=================================================================
== ğŸ¯ Clonando um PDB
=================================================================
â–¶ï¸ Clonar um PDB permite criar uma cÃ³pia exata de um PDB existente.

-- Clonar o PDB pdb1 para um novo PDB pdb1_clone
SQL> CREATE PLUGGABLE DATABASE pdb1_clone2 FROM pdb1
CREATE_FILE_DEST='/u03/oradata/';

=================================================================
== ğŸ¯ ConclusÃ£o
=================================================================
ğŸ’¡ Essas tarefas nÃ£o sÃ£o realizadas com frequÃªncia no dia a dia do DBA
ğŸ’¡ SÃ£o tarefas realizadas de forma mais pontual
ğŸ’¡ Ã‰ preciso treinar em laboratÃ³rios, para quando precisar realizÃ¡-las na prÃ¡tica, estar bem confiante
ğŸ’¡ Seja sempre cauteloso quando for excluir um PDB
 