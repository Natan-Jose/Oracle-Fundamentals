|-------------------------------------------------------------------------------|
| Aula		: Startup e shutdown												|
| MÃ³dulo	: Managing Oracle Database											|
| Curso		: Oracle Fundamentals												|
| Instrutor	: Marcio Mandarino													|
| URL		: mrdba.com.br/oracle_fundamentals									|
|-------------------------------------------------------------------------------|
| ReferÃªncia: https://docs.oracle.com/en/database/oracle/oracle-database/19/admin/starting-up-and-shutting-down.html#GUID-045DE684-6680-4099-A49E-2F5B5FA59670
|-------------------------------------------------------------------------------|


=================================================================
== ğŸ¯ Objetivos da Aula
=================================================================
ğŸ’¡ Aprender como funciona o processo de startup e shutdown do banco 
ğŸ’¡ Etapas do processo de startup
ğŸ’¡ Modos de inicializaÃ§Ã£o e shutdown
ğŸ’¡ Praticar o processo de shutdown e startup


=================================================================
== ğŸ¯ Resumo
=================================================================
ğŸ“ Conceito geral
ğŸ“ OpÃ§Ãµes para o startup do banco
ğŸ“ Etapas do Startup
ğŸ“ Modos de inicializaÃ§Ã£o
ğŸ“ Modos de Shutdown
ğŸ“ Comandos via sqlplus
ğŸ“ Alterando o status da instÃ¢ncia
ğŸ“ Comandos via srvctl
ğŸ“ ConclusÃ£o


=================================================================
== ğŸ¯ Conceito geral
=================================================================
â–¶ï¸ Ao iniciar um banco de dados, vocÃª cria uma instÃ¢ncia desse banco de dados e determina o estado do banco de dados. 
â–¶ï¸ Normalmente, vocÃª inicia uma instÃ¢ncia montando e abrindo o banco de dados. 
â–¶ï¸ Isso disponibiliza o banco de dados para qualquer usuÃ¡rio vÃ¡lido se conectar no banco de dados.


=================================================================
== ğŸ¯ OpÃ§Ãµes para o startup do banco
=================================================================
â–¶ï¸ Quando o banco de dados nÃ£o estÃ¡ configurado em cluster, vocÃª pode fazer o startup com as seguintes ferramentas:
	â–«ï¸ SQL*Plus
	â–«ï¸ Recovery Manager
	â–«ï¸ Oracle Enterprise Manager Cloud Control
â–¶ï¸ Quando o banco de dados estÃ¡ configurado como cluster, vocÃª pode usar uma outra opÃ§Ã£o:
	â–«ï¸ srvctl (Server Control)


=================================================================
== ğŸ¯ Etapas do Startup
=================================================================
â–¶ï¸ Etapa NOMOUNT:
	â–«ï¸ InicializaÃ§Ã£o da instÃ¢ncia.
	â–«ï¸ Leitura do arquivo de parÃ¢metros (pfile ou spfile).
	â–«ï¸ AlocaÃ§Ã£o da SGA e PGA e inÃ­cio dos processos de background.

â–¶ï¸ Etapa MOUNT:
	â–«ï¸ Montagem do banco de dados.
	â–«ï¸ Leitura do control file.

â–¶ï¸ Etapa OPEN:
	â–«ï¸ Abertura do banco de dados.
	â–«ï¸ Tornar o banco de dados acessÃ­vel para operaÃ§Ãµes.


=================================================================
== ğŸ¯ Modos de inicializaÃ§Ã£o
=================================================================
â–¶ï¸  Quando vocÃª abre um banco de dados (status open), ele pode ser inicializado atravÃ©s dos seguintes modos:
	â–«ï¸ Modo READ WRITE	: Banco de dados leitura e escrita (padrÃ£o).
	â–«ï¸ Modo RESTRICT		: Acesso restrito ao banco de dados.
	â–«ï¸ Modo READ ONLY	: Banco de dados somente leitura.


=================================================================
== ğŸ¯ Modos de Shutdown
=================================================================
â–¶ï¸ Quando vocÃª faz o shutdown do banco de dados, vocÃª pode escolher as seguintes opcÃµes:
	â–«ï¸ IMMEDIATE		: Desconecta todos os usuÃ¡rios e  volta as transaÃ§Ãµes nÃ£o confirmadas.
	â–«ï¸ ABORT			: Fecha o banco de dados imediatamente sem esperar transaÃ§Ãµes.
	â–«ï¸ NORMAL		: Aguarda todas as transaÃ§Ãµes serem concluÃ­das. NÃ£o permite novas conexÃµes.
	â–«ï¸ TRANSACTIONAL	: Aguarda as transaÃ§Ãµes atuais serem concluÃ­das, mas nÃ£o permite novas transaÃ§Ãµes.
â–¶ï¸ O shutdown immediate Ã© o mais utilizado.
ğŸ’€ O shutdown abort sÃ³ Ã© utilizado em casos extremos, pode corromper o banco.
â–¶ï¸ O shutdown transaction e normal, raramente sÃ£o utilizados (evite)


=================================================================
== ğŸ¯ Comandos via sqlplus
=================================================================
SQL> startup open; -- tambÃ©m funciona com apenas startup;
SQL> shutdown immediate;
SQL> startup;
SQL> shutdown transactional;
SQL> startup nomount;
SQL> shutdown abort;
SQL> startup mount;
SQL> shutdown immediate;
SQL> startup open read only;
SQL> shutdown immediate;
SQL> startup mount exclusive restrict; -- Drop database


=================================================================
== ğŸ¯ Alterando o status da instÃ¢ncia
=================================================================
SQL> shutdown immediate;
SQL> startup nomount;
SQL> alter database mount;
SQL> alter database open;

=================================================================
== Monitoramento em Tempo Real do Alert Log do Oracle
=================================================================

SQL> show parameter diag;

# cd /u01/app/oracle/diag/rdbms/cdb1/cdb1/trace
# tail -f alert_cdb1.log

====================================================================
== ğŸ¯ Comandos via srvctl (user grid)
====================================================================

-- realizando operaÃ§Ãµes no banco (em todas as instÃ¢ncias)
$ srvctl status database -d rac
$ srvctl status database -d rac -v
$ srvctl stop database -d rac -o immediate
$ srvctl status database -d rac
$ srvctl start database -d rac
$ srvctl status database -d rac
$ srvctl stop database -d rac -o transactional
$ srvctl status database -d rac


-- realizando operaÃ§Ãµes individualmente em cada instancia
$ srvctl stop instance -d rac -i rac1
$ srvctl start instance -d rac -i rac1
$ srvctl status database -d rac
$ srvctl start instance -d rac -i rac2
$ srvctl status database -d rac
$ srvctl stop instance -d rac -i rac2
$ srvctl start instance -d rac -i rac2
$ srvctl status database -d rac -v

========================================================================================
== ğŸ¯ ConclusÃ£o
========================================================================================
ğŸ’¡ Ã‰ fundamental entender os estÃ¡gios de startup e shutdown do banco
ğŸ’¡ Domine o processo de shutdown e startup
ğŸ’¡ Pratique os comandos acima, mas nÃ£o copie e cole
âš ï¸ Evite de todas as maneiras o uso do shutdown abort